{% extends "main/base.html" %}

{% block content %}
{% load static %}
{% load fontawesome %}
{% load mathfilters %}
<div class="container ds-detail">
  <!-- on click toggle .hidden, .form-value; make submit button visible -->
  <form id="ds_form" method="POST" action="#" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" name="id" value='{{ form.id }}'></input>
  <h4>Dataset Detail:
    <span class="edit small"><a href="#">{% fontawesome_icon 'edit' color='#336699' %}</a></span>
    <span class="form-value text-danger"> {{ object.name }}</span>
    <span class="hidden">{{ form.name }}
  </h4>
  <hr/>
  <div class="row">
    <div id="ds_details" class="col-sm-6">
      <p class="hidden editing"><b>Description</b>: {{ form.description }}</p>
      <p class="form-value editing"><b>Description</b>: {{ object.description }}</p>
      <p><b>Slug (id)</b>: {{ object.label }} ({{ object.id }})
      <p><b>File</b>: {{ object.file }}</p>
      <p><b>Date</b>: {{ object.upload_date }}</p>
      <p><b>Total rows</b>: {{ object.numrows }}</p>
      <p><b>Data type</b>: {{ object.datatype }}</p>
      <p><b>Format</b>: {{ object.format }} ({{ object.delimiter }})</p>
      {% if object.format == "delimited" %}
        <p><b>Sources file</b>:</p>
      {% endif %}
      {% if object.mapbox_id %}
        <p class="form-value"><b>MapBox ID</b>: {{ object.mapbox_id }}</p>
        <p class="hidden editing"><b>MapBox ID</b>: {{ form.mapbox_id }}</p>
      {% endif %}
      <p><b>Status</b>: {{ object.status }}</p>
      <p><b>Columns</b>: <br/>{{ object.header }}</p>
      <hr/>
      <h5 class="text-secondary">Counts (initial, added)</h5>
      <p><b>Names</b>:
        {{ num_names }}, <span class="text-white bg-danger">&nbsp;{{ names_added }}&nbsp;</span></p>
      <p><b>Links</b>:
        {{ num_links }}, <span class="text-white bg-danger">&nbsp;{{ links_added }}&nbsp;</span></p>
      <p><b>Geometries</b>: {{ num_geoms }}, <span class="text-white bg-danger">&nbsp;{{ geoms_added }}&nbsp;</span></p>
      <p><b>Descriptions</b>: {{ num_descriptions }}, <span class="text-white bg-danger">&nbsp;{{ descriptions_added }}&nbsp;</span></p>
      <input class="btn btn-primary hidden" type="submit" value="Save" />
  </div>
  <div id="ds_recon" class="col-sm-6">
    <h5 class="text-secondary">Reconciliation Tasks <span><a href="{% url 'datasets:ds_recon' object.id %}" class="ml-5">{% fontawesome_icon 'plus-square' color='#336699' %}</a></span>
    </h5>
    {% for t in tasks %}
      <p class="mb-0 mt-2">{{ t.task_name }} <span class="small">({{ t.date_done }})</span>
         <a href="{% url 'datasets:review' pk=object.id tid=t.task_id %}"><i>review</i></a>&nbsp;
         <!-- TODO: confirm, select which to delete -->
         <a href="{% url 'datasets:task-delete' tid=t.task_id %}">
           {% fontawesome_icon 'trash' color='#336699' %}</a>
      </p>
    {% endfor %}
  </div>
  </form>
</div>
<script type="text/javascript">
  $(".edit").click(function() {
    $(".hidden").toggle()
    $(".form-value").addClass("hidden")
    // $(".btn").toggleClass('hidden btn')
    console.log ('clicked')
  })
</script>
{% endblock %}
