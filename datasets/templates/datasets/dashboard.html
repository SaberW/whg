<!-- datasets/home.html -->
{% extends "main/base.html" %}
{% block title %}<title>WHG::Dashboard</title>{% endblock %}

{% block content %}
  {% load static %}
  {% load fontawesome %}
  {% load mathfilters %}

  <div class="container">
    <!--<div class="px-5 mt-3"> -->
      <h4 class="mt-3">My Datasets
        <a href="{% url 'datasets:dataset-create' %}" class="ml-5">{% fontawesome_icon 'plus-square' color='#336699' %}</a></h4>
      <div id="dataset_list">
      {% for d in dataset_list %}
        <div class="dataset-box mb-2">
          <h4>{{ d.name }}
            <!-- onclick="return confirm('Are you sure?')" -->
            <a href="{% url 'datasets:dataset-delete' d.id %}" class=" float-right"
              title="Delete dataset" rel="tooltip">
              {% fontawesome_icon 'trash' color='#336699' %}</a>
            <a href="{{ d.get_absolute_url }}" title="Edit metadata" rel="tooltip"
            class="float-right mr-3">{% fontawesome_icon 'edit' color='#336699' %}</a>
            {% if d.status == 'uploaded' or d.status == 'inserted' %}
            <a href="{% url 'datasets:ds_grid' d.label %}" title="View/edit table" rel="tooltip"
            class="float-right mr-3">{% fontawesome_icon 'table' color='#336699' %}</a>
            <a href="{% url 'datasets:dataset-detail' d.id %}" title="Detail" rel="tooltip"
            class="float-right mr-3">{% fontawesome_icon 'cog' color='#336699' %}</a>
            <a href="{% url 'datasets:ds_recon' d.id %}" title="Reconciler" rel="tooltip"
            class="float-right mr-3">{% fontawesome_icon 'link' color='#336699' %}</a>
            {% endif %}
            {% if d.status == 'format_ok' %}
            <a href="{% url 'datasets:ds_insert' d.id %}" title="Insert to db" rel="tooltip"
            class="float-right mr-3">{% fontawesome_icon 'database' color='#336699' %}</a>
            {% endif %}
          </h4>
          <div class="row">
            <div id="ds_metadata" class="col-sm-6"><p>
              <b>ID</b>: {{ d.id }}&nbsp;&nbsp;<b>Label</b>: {{ d.label }} <br/>
              <b>Description</b>: {{ d.description }} <br/>
                {% if d.file %}
                  <b>File</b>: <span class="text-danger">{{ d.file }}</span><br/>
                {% endif %}
              <b>Uploaded</b>: {{ d.upload_date }}<br/>
               {% if d.mapbox_id %}
               {% autoescape on %}
                 <span><a href="{% url 'map_view' mid=d.mapbox_id|escape %}">Map</a></span>
                 <br/>
               {% endautoescape %}
               {% endif %}
              <b>Status</b>: <span class="text-danger">{{ d.status }}</span>
            </p>
            </div>
            <div id="ds_tasks" class="col-sm-5">
              <p class="font-weight-bold mb-1">Reconciliation tasks</p>
              {% for t in d.tasks %}
                <p class="mb-0 small">{{ t.task_name }} <span class="small">({{ t.date_done }})</span>
                   <a href="{% url 'datasets:review' pk=d.id tid=t.task_id %}"><i>review</i></a>&nbsp;
                   <!-- TODO: confirm, select which to delete -->
                   <a href="{% url 'datasets:task-delete' tid=t.task_id %}">
                     {% fontawesome_icon 'trash' color='#336699' %}</a>
                </p>
              {% endfor %}
            </div>
          </div>
          {% if d.status == "inserted" or d.status == "ready" %}
          <div class="row dataset-detail">
           <p>
             <b>{{ d.numrows }}</b> rows; <b>{{ d.numlinked }}</b> have total of <b>{{ d.total_links }}</b> match links; <b>{{ d.numrows|sub:d.numlinked }}</b> have none<br/>
             <b>Columns</b>: {{ d.header }} <br/>
           </p>
          </div>
          {% endif %}
        </div>
      {% endfor %}
      </div>
    <!-- </div> -->
  </div> <!-- container -->
  <script>
    $("[rel='tooltip']").tooltip();
    // $(document).on('click', '.confirm-delete', function(){
    //   var r = confirm('Are you sure ?');
    //
    // })

    // TODO: prettier
    // function testConfirm() {
    //   var $dialog = $('<div></div>')
    //     .html("Are you sure you want to delete?")
    //     .dialog({
    //       resizable: false,
    //       title: "Confirm Deletion",
    //       modal: true,
    //       buttons: {
    //         Cancel: function() {
    //           $(this).dialog("close");
    //         },
    //         "Delete": function() {
    //           //some stuff
    //           $(this).dialog("close");
    //         }
    //       }
    //     });
    //
    //   $dialog.dialog('open');
    // }
  </script>
{% endblock %}
