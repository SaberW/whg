<!-- datasets/home.html -->
{% extends "main/base.html" %}
{% block title %}<title>WHG::Dashboard</title>{% endblock %}

{% block content %}
  {% load static %}
  {% load fontawesome %}
  {% load mathfilters %}
  {% load dataset_extras %}

  <div class="container">
    <div id="dataset_list" class="mt-3">
      <h4 class="mt-3">Datasets
        <a href="{% url 'datasets:dataset-create' %}" class="ml-5">{% fontawesome_icon 'plus-square' color='#336699' %}</a>
      </h4>
      <div class="list-box">
        <table class="table table-striped">
          <thead>
            <th></th>
            <th>id</th>
            <th>name</th>
            <th>label</th>
            <th>uploaded</th>
            <th>format</th>
            <th># rows</th>
            <th>status</th>
            <th>owner</th>
            <th>&nbsp;</th>
          </thead>
          <tbody>
            {% for d in dataset_list %}
              <tr class="place-row">
                <td>{% if d.spine %}<i class="small">spine<i>{% endif %}</td>
                <td>{{ d.id }}</td>
                <td><a href="{% url 'datasets:dataset-detail' d.id %}">{{ d.name }}</a></td>
                <td>{{ d.label }}</td>
                <td class="small">{{ d.upload_date|date:"d-M-Y, H:i (e)" }}</td>
                <td>{{ d.format }}</td>
                <td><span class="float-right mr-2">{{ d.numrows }}</span></td>
                <td>{{ d.status }}</td>
                <td>{{ d.owner }}</td>
                <td>
                  {% if d.status == "format_ok" %}
                  <a href="{% url 'datasets:ds_insert' d.id %}" title="Insert to db" rel="tooltip"
                  class="">{% fontawesome_icon 'database' color='#336699' %}</a>
                  {% elif d.status == "in_database" %}
                  <a href="{% url 'datasets:drf_table' label=d.label f='all' %}" title="View/edit table" rel="tooltip"
                  class="float-right mr-2">{% fontawesome_icon 'table' color='#336699' %}</a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
      <div class="row">
      <div id="area_list" class="col-sm-6 mt-3">
        <h4 class="mt-3">Study Areas
          <a href="{% url 'areas:area-create' %}" class="ml-5">
            {% fontawesome_icon 'plus-square' color='#336699' %}</a></h4>
        <div class="list-box">
          <table class="table table-striped">
            <thead>
                <th>id</th>
                <th>title</th>
                <th>type</th>
                <th>ccodes</th>
            </thead>
            <tbody>
              {% for a in area_list %}
                <tr class="place-row">
                  <!-- <td><span class="edit-row" style="cursor:pointer;">
                    {# fontawesome_icon 'edit' color='#336699' #}</span</td> -->
                  <td>{{ a.id }}</td>
                  <td><a href="{% url 'areas:area-update' a.id %}">{{ a.title }}</a></td>
                  <td>{{ a.type }}</td>
                  <td>{{ a.ccodes }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div id="review_list" class="col-sm-6 mt-3">
        <h4 class="mt-3">Reconciliation tasks</h4>
        <div class="list-box">
            <table class="table table-striped">
              <thead>
                  <th>id</th>
                  <th>dataset</th>
                  <th>authority</th>
                  <th>date</th>
                  <th></th>
              </thead>
              <tbody>
                {% for r in review_list %}
                  <tr class="place-row">
                    <!-- <td><span class="edit-row" style="cursor:pointer;">
                      {# fontawesome_icon 'edit' color='#336699' #}</span</td> -->
                    <td>{{ r.id }}</td>
                    <td>{{ r.task_kwargs|parsejson:"dslabel" }}</td>
                    <td><b>{{ r.task_name|cut:"align_" }}</b></td>
                    <td class="small">{{ r.date_done|date:"d-M-Y, H:i (e)" }}</td>
                    <td>
                      <a href="{% url 'datasets:review' pk=r.task_args|trimbrackets tid=r.task_id %}"
                        title="Review hits" rel="tooltip">
                        {% fontawesome_icon 'search' color='#336699' %}
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
        </div>
      </div>
      <!-- <div id="collection_list" class="col-sm-4 mt-3">
        <h4 class="mt-3">Collections
          <a href="{# url 'areas:area-create' #}" class="ml-5">
            {# fontawesome_icon 'plus-square' color='#336699' #}</a></h4>
        <div class="list-box"><p>User collections of place and trace records (eventually)</p></div>
      </div> -->
    </div
    </div>
  <script>
    $("[rel='tooltip']").tooltip();
  </script>
{% endblock %}
